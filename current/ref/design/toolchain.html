<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Workflow using Connectal &mdash; connectal 15.08.5 documentation</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '15.08.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="connectal 15.08.5 documentation" href="../index.html" />
    <link rel="up" title="Connectal Design" href="design.html" />
    <link rel="next" title="Performance of Generated Systems" href="performance.html" />
    <link rel="prev" title="Implementing String Search" href="implementing-string-search.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../bsv-pkgindex.html" title="Bsv Package Index"
             >bsvpkgs</a> |</li>
        <li class="right" >
          <a href="performance.html" title="Performance of Generated Systems"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="implementing-string-search.html" title="Implementing String Search"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">connectal 15.08.5 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="design.html" accesskey="U">Connectal Design</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="workflow-using-connectal">
<span id="sec-toolchain"></span><h1>Workflow using Connectal<a class="headerlink" href="#workflow-using-connectal" title="Permalink to this headline">¶</a></h1>
<p>In this section, we give an overview of the Connectal workflow and
toolchain.  The complete toolchain, libraries, and many running
examples may be obtained at textit{www.connectal.org} or by emailing
<a class="reference external" href="mailto:textit{connectal&#37;&#52;&#48;googlegroups&#46;com">textit{connectal<span>&#64;</span>googlegroups<span>&#46;</span>com</a>}.</p>
<div class="section" id="top-level-structure-of-connectal-applications">
<h2>Top level structure of Connectal applications<a class="headerlink" href="#top-level-structure-of-connectal-applications" title="Permalink to this headline">¶</a></h2>
<p>The simplest Connectal application consists of 4 files:</p>
<div class="section" id="makefile">
<h3>Makefile<a class="headerlink" href="#makefile" title="Permalink to this headline">¶</a></h3>
<p>The top-level Makefile defines parameters for the entire application
build process.  In its simplest form, it specifies which Bluespec
interfaces to use as portals, the hardware and software source files,
and the libraries to use for the hardware and software compilation.</p>
</div>
<div class="section" id="application-hardware">
<h3>Application Hardware<a class="headerlink" href="#application-hardware" title="Permalink to this headline">¶</a></h3>
<p>Connectal applications typically have at least one BSV file containing
declarations of the interfaces being exposed as portals, along with
the implementation of the application hardware itself.</p>
</div>
<div class="section" id="top-bsv">
<h3>Top.bsv<a class="headerlink" href="#top-bsv" title="Permalink to this headline">¶</a></h3>
<p>In this file, the developer instantiates the application hardware
modules, connecting them to the generated wrappers and proxies for the
portals exported to software.  To connect to the host processor bus, a
parameterized standard interface is used, making it easy to synthesize
the application for different CPUs or for simulation.  If CPU specific
interface signals are needed by the design (for example, extra clocks
that are generated by the PCIe core), then an optional CPU-specific
interface can also be used.</p>
<p>If the design uses multiple clock domains or additional pins on the
FPGA, those connections are also made here by exporting a &#8216;Pins&#8217;
interface.  The Bluespec compiler generates a Verilog module from the
top level BSV module, in which the methods of exposed interfaces are
implemented as Verilog ports. Those ports are associated to physical
pins on the FPGA using a physical constraints file.</p>
</div>
<div class="section" id="application-cpp">
<h3>Application CPP<a class="headerlink" href="#application-cpp" title="Permalink to this headline">¶</a></h3>
<p>The software portion of a Connectal application generally consists of
at least one C++ file, which instantiates the generated software
portal wrapper and proxies.  The application software is also
responsible for implementing main.</p>
</div>
</div>
<div class="section" id="development-cycle">
<h2>Development cycle<a class="headerlink" href="#development-cycle" title="Permalink to this headline">¶</a></h2>
<p>After creating or editing the source code for the application, the
development cycle consists of four steps: generating makefiles,
compiling the interface, building the application, and running the
application.</p>
<div class="section" id="generating-makefiles">
<h3>Generating Makefiles<a class="headerlink" href="#generating-makefiles" title="Permalink to this headline">¶</a></h3>
<p>Given the parameters specified in the application Makefile and a
platform target specified at the command line, Connectal generates a
target-specific Makefile to control the build process. This Makefile
contains the complete dependency information for the generation of
wrappers/proxies, the use of these wrappers/proxies in compiling both
the software and hardware, and the collection of build artifacts into
a package that can be either run locally or over a network to a remote
&#8216;device under test&#8217; machine.</p>
</div>
<div class="section" id="compiling-the-interface">
<h3>Compiling the Interface<a class="headerlink" href="#compiling-the-interface" title="Permalink to this headline">¶</a></h3>
<p>The Connectal interface compiler generates the C++ and BSV files to
implement wrappers and proxies for all interfaces specified in the
application Makefile.  Human readable textbf{JSON} is used as an
intermediate representation of portal interfaces, exposing a useful
debugging window as well as a path for future support of
additional languages and IDLs.</p>
</div>
<div class="section" id="building-the-application">
<h3>Building the Application<a class="headerlink" href="#building-the-application" title="Permalink to this headline">¶</a></h3>
<p>A target in the generated Makefile invokes GCC to compiler the
software components of the application.  The Bluespec compiler (bsc)
is then invoked to compiler the hardware components to Verilog.  A
parameterized Tcl scripts is used to drive Vivado to build the Xilinx
FPGA configuration bitstream for the design.</p>
<p>A Connectal utility called <a class="reference external" href="https://github.com/cambridgehackers/fpgamake">fpgamake</a> supports
specification of which Bluespec and Verilog modules should be compiled to
separate netlists and to enable separate place and route of those
netlists given a floor plan. Separate synthesis and floor planning in
this manner can reduce build times, and to make it easier to meet
timing constraints.</p>
<p>Another Connectal utility called <a class="reference external" href="https://github.com/cambridgehackers/buildcache">buildcache</a>
speeds recompilation by caching previous compilation results
and detecting cases where input files have not changed.
Although similar to the better-known utility textit{ccache}, this
program has no specific knowledge of the tools being executed,
allowing it to be integrated into any workflow and any tool set.
This utility
uses the system call textbf{strace} to track which files are read and
written by each build step, computing an &#8216;input signature&#8217; of the MD5
checksum for each of these files.  When the input signature matches,
the output files are just refreshed from the cache, avoiding the long
synthesis times for the unchanged portions of the project.</p>
</div>
<div class="section" id="running-the-application">
<h3>Running the Application<a class="headerlink" href="#running-the-application" title="Permalink to this headline">¶</a></h3>
<p>As part of our goal to have a fully scripted design flow, the
generated Makefile includes a texttt{run} target that will program
the FPGA and launch the specified application or test bench.  In order
to support shared target hardware resources, the developer can direct the run
to a particular machines, which can be accessed over the network.  For
Ubuntu target machines, ssh is used to copy/run the application.  For
Android target machines, &#8216;adb&#8217; is used.</p>
</div>
</div>
<div class="section" id="continuous-integration-and-debug-support">
<h2>Continuous Integration and Debug Support<a class="headerlink" href="#continuous-integration-and-debug-support" title="Permalink to this headline">¶</a></h2>
<p>Connectal provides a fully scripted flow in order to make it easy to
automate the building and running of applications for continuous
integration. Our development team builds and runs large collections of
tests whenever the source code repository is updated.</p>
<p>Connectal also provides trace ring buffers in hardware and analysis software
to trace and display the last transactions on the PCIe or AXI memory
bus. This trace is useful when debugging performance or correctness
problems, answering questions of the form:</p>
<ul class="simple">
<li>What were the last memory requests and responses?</li>
<li>What was the timing of the last memory request and responses?</li>
<li>What were the last hardware method invocations or indications?</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Workflow using Connectal</a><ul>
<li><a class="reference internal" href="#top-level-structure-of-connectal-applications">Top level structure of Connectal applications</a><ul>
<li><a class="reference internal" href="#makefile">Makefile</a></li>
<li><a class="reference internal" href="#application-hardware">Application Hardware</a></li>
<li><a class="reference internal" href="#top-bsv">Top.bsv</a></li>
<li><a class="reference internal" href="#application-cpp">Application CPP</a></li>
</ul>
</li>
<li><a class="reference internal" href="#development-cycle">Development cycle</a><ul>
<li><a class="reference internal" href="#generating-makefiles">Generating Makefiles</a></li>
<li><a class="reference internal" href="#compiling-the-interface">Compiling the Interface</a></li>
<li><a class="reference internal" href="#building-the-application">Building the Application</a></li>
<li><a class="reference internal" href="#running-the-application">Running the Application</a></li>
</ul>
</li>
<li><a class="reference internal" href="#continuous-integration-and-debug-support">Continuous Integration and Debug Support</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="implementing-string-search.html"
                        title="previous chapter">Implementing String Search</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="performance.html"
                        title="next chapter">Performance of Generated Systems</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/design/toolchain.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../bsv-pkgindex.html" title="Bsv Package Index"
             >bsvpkgs</a> |</li>
        <li class="right" >
          <a href="performance.html" title="Performance of Generated Systems"
             >next</a> |</li>
        <li class="right" >
          <a href="implementing-string-search.html" title="Implementing String Search"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">connectal 15.08.5 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="design.html" >Connectal Design</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Jamey Hicks, Myron King, John Ankcorn.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
<script type="text/javascript" src="../_static/ga.js"></script>  
  </body>
</html>